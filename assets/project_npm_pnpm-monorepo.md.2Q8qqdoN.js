import{_ as a,o as i,c as n,ae as p}from"./chunks/framework.h0LyDJ8h.js";const c=JSON.parse('{"title":"极简 Pnpm Monorepo 单体仓库","description":"","frontmatter":{},"headers":[],"relativePath":"project/npm/pnpm-monorepo.md","filePath":"project/npm/pnpm-monorepo.md"}'),t={name:"project/npm/pnpm-monorepo.md"};function l(e,s,h,k,o,r){return i(),n("div",null,[...s[0]||(s[0]=[p(`<h1 id="极简-pnpm-monorepo-单体仓库" tabindex="-1">极简 Pnpm Monorepo 单体仓库 <a class="header-anchor" href="#极简-pnpm-monorepo-单体仓库" aria-label="Permalink to &quot;极简 Pnpm Monorepo 单体仓库&quot;">​</a></h1><blockquote><p>写在开始，点击传送门了解 <a href="https://www.pnpm.cn/" target="_blank" rel="noreferrer">pnpm</a> monorepo <a href="https://xie.infoq.cn/article/4f870ba6a7c8e0fd825295c92" target="_blank" rel="noreferrer">5 分钟搞懂 Monorepo</a></p></blockquote><blockquote><p>如果不确定项目是否该使用 monorepo，那大概是不需要。</p></blockquote><blockquote><p>适用于多包项目，满足多包公共依赖配置抽离，多包分别管理开发、发布，解决开发过程中包之间调试和版本更新问题。</p></blockquote><h2 id="_1-安装-pnpm-参考官网" tabindex="-1">1. 安装 pnpm <a href="https://www.pnpm.cn/installation" target="_blank" rel="noreferrer">参考官网</a> <a class="header-anchor" href="#_1-安装-pnpm-参考官网" aria-label="Permalink to &quot;1. 安装 pnpm [参考官网](https://www.pnpm.cn/installation)&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 pnpm 版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><h2 id="_2-创建根项目" tabindex="-1">2. 创建根项目 <a class="header-anchor" href="#_2-创建根项目" aria-label="Permalink to &quot;2. 创建根项目&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建项目目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fe-infra</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入项目</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fe-infra</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初始化项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span></code></pre></div><h2 id="_3-添加-pnpm-workspace-yaml" tabindex="-1">3. 添加 pnpm-workspace.yaml <a class="header-anchor" href="#_3-添加-pnpm-workspace-yaml" aria-label="Permalink to &quot;3. 添加 pnpm-workspace.yaml&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 yaml 文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm-workspace.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># yaml 文件 增加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">packages:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;packages/*&#39;</span></span></code></pre></div><h2 id="_4-创建子项目" tabindex="-1">4. 创建子项目 <a class="header-anchor" href="#_4-创建子项目" aria-label="Permalink to &quot;4. 创建子项目&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建子项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建示例项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初始化示例项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 非必须 使用 @scope/name 重命名 pkg name 为 @infra/tools。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重复以上步骤 创建 web 子项目</span></span></code></pre></div><h2 id="_5-添加依赖" tabindex="-1">5. 添加依赖 <a class="header-anchor" href="#_5-添加依赖" aria-label="Permalink to &quot;5. 添加依赖&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 根目录添加 prettier 到开发依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prettier</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 示例：安装开源 @infra/tools 安装 lodash 依赖。删除 remove</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @infra/tools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lodash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 示例：安装项目间依赖， @infra/qui-antd 安装 @infra/tools 依赖。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @infra/web</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @infra/tools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动依赖 workspace 最新版本：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 web -- pkg.json 将  &quot;@infra/tools&quot;: &quot;workspace:^1.0.0&quot; 修改为 &quot;@infra/tools&quot;: &quot;workspace:*&quot;。</span></span></code></pre></div><h2 id="_6-根目录增加-npm-指令" tabindex="-1">6. 根目录增加 npm 指令 <a class="header-anchor" href="#_6-根目录增加-npm-指令" aria-label="Permalink to &quot;6. 根目录增加 npm 指令&quot;">​</a></h2><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tools:dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm --dir ./packages/tools dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tools:build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm --dir ./packages/tools build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;echo </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Error: no test specified</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &amp;&amp; exit 1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span></code></pre></div><h2 id="_7-业务项目开发-将子项目换成业务项目即可。" tabindex="-1">7. 业务项目开发，将子项目换成业务项目即可。 <a class="header-anchor" href="#_7-业务项目开发-将子项目换成业务项目即可。" aria-label="Permalink to &quot;7. 业务项目开发，将子项目换成业务项目即可。&quot;">​</a></h2><p>示例不包含公共配置抽离，可参考 <a href="https://github.com/youzan/vant" target="_blank" rel="noreferrer">Vant Monorepo 配置</a>。</p>`,19)])])}const g=a(t,[["render",l]]);export{c as __pageData,g as default};
